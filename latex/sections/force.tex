\documentclass[../main.tex]{subfiles}

\begin{document}

\section{Force model}\label{sec:force}
So far we have only considered the gravitational force acting point masses. In reality, the Earth is not a point mass, neither a spherically symmetric mass distribution. In this section we will deep into the details of a more realistic model of the Earth's gravitational field.
\subsection{Geopotential model}
\subsubsection{Continuous distribution of mass}
In \cref{sec:twoBody} we have seen that the motion of a body orbiting another one can be described by a conic section. However, we have not been concerned about the mass distribution of the large body, in our case the Earth. In this section we will see that the motion of the smaller body, the satellite, is slightly perturbed by the mass distribution of the larger one as well as the precense of other forces such as atmospheric drag, solar radiation pressure, and the gravitational pull of the Moon and Sun, which we wil talk later on. Even though, the perturbations are relatively small and the orbits of the satellites are still approximating ellipses.

Consider a body confined in a compact region $\Omega\subseteq\RR$ with a continuous density of mass $\rho:\Omega\to\RR$. We would like to know the gravitational pull on a point mass $m$ located at position $\vf{r}$ from the center of mass of the body. To do this we can discretize the body $\Omega$ in a set of cubes $m_{i,j,k}$ each of volume $\frac{1}{n_xn_yn_z}$ and density $\rho(\frac{i}{n_x},\frac{j}{n_y},\frac{k}{n_z})=:\rho_{i,j,k}$, where $n_x$, $n_y$, and $n_z$ are the number of cubes in the $x$, $y$, and $z$ directions, respectively. The total gravitational acceleration $\vf{g}$ exerted on $m$ is the sum of the contributions of all the forces and it is given by:
\begin{equation}\label{eq:riemann_sum}
  \vf{g}=-\sum_{i=0}^{n_x}\sum_{j=0}^{n_y}\sum_{k=0}^{n_z}\frac{m_{i,j,k}}{\norm{\vf{r}-\vf{s}_{i,j,k}}^3}(\vf{r}-\vf{s}_{i,j,k})=-\sum_{i=0}^{n_x}\sum_{j=0}^{n_y}\sum_{k=0}^{n_z}\frac{\rho_{i,j,k}}{\norm{\vf{r}-\vf{s}_{i,j,k}}^3}(\vf{r}-\vf{s}_{i,j,k})\frac{1}{n_xn_yn_z}
\end{equation}
where $\vf{s}_{i,j,k}=(\frac{i}{n_x},\frac{j}{n_y},\frac{k}{n_z})$ (in cartesian coordinates). Note that \cref{eq:riemann_sum} is a Riemann sum and so letting $n_x,n_y,n_z\to\infty$ we get:
\begin{equation}\label{eq:limit}
  \vf{g}=-\int_{\Omega}\frac{\rho(\vf{s})}{\norm{\vf{r}-\vf{s}}^3}(\vf{r}-\vf{s})\dd^3{\vf{s}}
\end{equation}
where $\dd^3{\vf{s}}:=\dd{x'}\dd{y'}\dd{z'}$, if $\vf{s}=(x',y',z')$.
\begin{theorem}\label{thm:conservative}
  Let $\Omega$ be a compact region in $\RR^3$ with a continuous density of mass $\rho:\Omega\to\RR$. Then, the gravitational acceleration field $\vf{g}$ is conservative. That is, there exists a function $f:\RR^3\rightarrow\RR$ such that $\vf{g}=\grad f$.
\end{theorem}
\begin{proof}
  An easy computation shows that fixed $\vf{s}\in\RR^3$ we have:
  \begin{equation}
    \grad\left(\frac{1}{\norm{\vf{r}-\vf{s}}}\right)=-\frac{1}{\norm{\vf{r}-\vf{s}}^3}(\vf{r}-\vf{s})
  \end{equation}
  So we need to justify if the following exchange of the gradient and the integral is correct:
  \begin{equation}
    \vf{g}=-\int_{\Omega}\frac{\rho(\vf{s})}{\norm{\vf{r}-\vf{s}}^3}(\vf{r}-\vf{s})\dd^3{\vf{s}}=\int_{\Omega}\rho(\vf{s})\grad\left(\frac{1}{\norm{\vf{r}-\vf{s}}}\right)\dd^3{\vf{s}}=\grad\int_{\Omega}\frac{\rho(\vf{s})}{\norm{\vf{r}-\vf{s}}}\dd^3{\vf{s}}
  \end{equation}
  Without loss of generality it suffices to justify that
  \begin{equation}\label{eq:exchangeDivInt}
    \pdv{}{x}\int_{\Omega}\frac{\rho(\vf{s})}{\norm{\vf{r}-\vf{s}}}\dd^3{\vf{s}}=\int_{\Omega}\pdv{}{x}\left(\frac{\rho(\vf{s})}{\norm{\vf{r}-\vf{s}}}\right)\dd^3{\vf{s}}
  \end{equation}
  assuming $\vf{r}=(x,y,z)$ and $\vf{s}=(x',y',z')$. In order to apply the theorem of derivation under the integral sign we need to control $\pdv{}{x}\left(\frac{\rho(\vf{s})}{\norm{\vf{r}-\vf{s}}}\right)=-\rho(\vf{s})\frac{x-x'}{\norm{\vf{r}-\vf{s}}^3}$ by an integrable function $h(\vf{s})$. Using spherical coordinates centered at $\vf{r}$ and writing ${(\vf{r}-\vf{s})}_{\mathrm{sph}}=(\rho_{\vf{r}},\theta,\phi)$, the integrand to bound becomes (in spherical coordinates):
  \begin{equation}
    \abs{-\rho(\vf{s})\frac{x-x'}{\norm{\vf{r}-\vf{s}}^3}{\rho_{\vf{r}}}^2\sin\phi}=\abs{\rho(\vf{s})}\abs{\frac{{\rho_{\vf{r}}}\cos\theta\sin\phi}{{\rho_{\vf{r}}}^3}{\rho_{\vf{r}}}^2\sin\phi}\leq \abs{\rho(\vf{s})}\leq K
  \end{equation}
  where the last inequality follows for certain $K\in\RR$ by Weierstra\ss\ theorem ($\rho$ is continuous and $\Omega$ is compact). Thus, since $h(\vf{s})=K$ is integrable, because $\Omega$ is bounded, the equality of \cref{eq:exchangeDivInt} is licit.
\end{proof}
Physically speaking, the gravitational force being conservative means that the work done by the force is independent of the path taken by the particle. Moreover, due to historical reasons, we will write $\vf{g}=-\grad V$ (with the minus sign) and call $V$ the \emph{gravitational potential}. The minus sign is chosen according the convention that work done by gravitational forces decreases the potential.
\subsubsection{Laplace equations}
\begin{theorem}
  Consider distribution of matter of density $\rho$ in a compact region $\Omega$. Then, the gravitational potential $V$ satisfies the Laplace equation
  \begin{equation}
    \laplacian V = 0
  \end{equation}
  for all points outside $\Omega$\footnote{It can be seen that $V$ satisfies in fact the \emph{Poisson equation} $\laplacian V=4\pi G\rho$ for any point $\vf{r}\in\RR^3$, which reduced to Laplace equation when $\vf{r}\in\Omega^c$, because there we have $\rho(\vf{r})=0$.}.
\end{theorem}
\begin{proof}
  Recall that $\laplacian V=\div(\grad V)$. So since $\vf{g}=-\grad V$ it suffices to prove that $\div(\vf{g})=0$. Note that if $\vf{r}\in\Omega^c$ and $\vf{s}\in\Omega$ then $\norm{\vf{r}-\vf{s}}\geq\delta>0$, so $\frac{\vf{r}-\vf{s}}{\norm{\vf{r}-\vf{s}}^3}$ is differentiable and:
  \begin{multline*}
    \div\left(\frac{\vf{r}-\vf{s}}{\norm{\vf{r}-\vf{s}}^3}\right)=\pdv{}{x}\left(\frac{x-x'}{\norm{\vf{r}-\vf{s}}^3}\right)+\pdv{}{y}\left(\frac{y-y'}{\norm{\vf{r}-\vf{s}}^3}\right)+\pdv{}{z}\left(\frac{z-z'}{\norm{\vf{r}-\vf{s}}^3}\right)=\\
    =\frac{\norm{\vf{r}-\vf{s}}^2-3{(x-x')}^2}{\norm{\vf{r}-\vf{s}}^5}+\frac{\norm{\vf{r}-\vf{s}}^2-3{(y-y')}^2}{\norm{\vf{r}-\vf{s}}^5}+\frac{\norm{\vf{r}-\vf{s}}^2-3{(z-z')}^2}{\norm{\vf{r}-\vf{s}}^5} =0
  \end{multline*}
  Hence, as in \cref{thm:conservative}, we have that for each $\vf{r}\in\Omega^c$ $\exists\varepsilon,\delta>0$ such that $\forall \vf{\tilde{r}} \in B(\vf{r},\varepsilon)$ we have:
  $$
    \abs{\rho(\vf{s})\frac{\norm{\vf{\tilde{r}}-\vf{s}}^2-3{(\tilde{x}-x')}^2}{\norm{\vf{\tilde{r}}-\vf{s}}^5}}\leq \frac{4\abs{\rho(\vf{s})}}{\norm{\vf{\tilde{r}}-\vf{s}}^3}\leq \frac{4\abs{\rho(\vf{s})}}{\delta^3}
  $$
  which is integrable by Weierstra\ss\ theorem. Thus, by the theorem of derivation under the integral sign:
  \begin{equation}
    \div(\vf{g})=-\div\int_\Omega\frac{\rho(\vf{s})}{\norm{\vf{r}-\vf{s}}^3}(\vf{r}-\vf{s})\dd^3{\vf{s}}=-\int_\Omega\rho(\vf{s})\div\left(\frac{\vf{r}-\vf{s}}{\norm{\vf{r}-\vf{s}}^3}\right)\dd^3{\vf{s}}=0
  \end{equation}
\end{proof}
So far we have seen that the gravitational potential $V$ satisfies the Laplace equation. If moreover we choose the origin of potential to be at the infinity, that is, if we impose $\displaystyle\lim_{\norm{\vf{r}}\to\infty}V=0$, then the gravitational potential created by a distribution of mass in a compact region $\Omega$ is a solution of the following exterior Dirichlet problem:
\begin{equation}\label{eq:dirichletProblem}
  \begin{cases}
    \laplacian V = 0 & \text{in } \Omega^c    \\
    V = f            & \text{on } \Fr{\Omega} \\
    \displaystyle\lim_{\norm{\vf{r}}\to\infty}V=0
  \end{cases}
\end{equation}
If $\Omega$ represents the Earth, then $f=f(\theta,\phi)$ represents is the boundary condition concerning the gravitational potential at the surface of the Earth as a function of the longitude $\theta$ and colatitude $\phi$.

We wil see now that \cref{eq:dirichletProblem} has uniqueness of solutions. To do that we invoke the maximum principle, which we will not prove  (see \cite{evans} for more details).
\begin{theorem}[Maximum principle]
  Let $U\subseteq \RR^n$ be open and bounded and $u\in\mathcal{C}^2(U)\cap \mathcal{C}(\overline{U})$. Suppose that $u$ is harmonic within $U$, that is, $\laplacian u=0$ in $U$. Then, $\max_{\overline{U}}u=\max_{\partial U}u$.
\end{theorem}
\begin{corollary}
  The Dirichlet problem of \cref{eq:dirichletProblem} has a unique solution.
\end{corollary}
\begin{proof}
  Suppose we have two solutions $V_1$, $V_2$ of \cref{eq:dirichletProblem}. Then, $W:=V_1-V_2$ is harmonic in $\Omega^c$ and $W=0$ on $\Fr{\Omega}$. Moreover, $\displaystyle\lim_{\norm{\vf{r}}\to\infty}W=0$. So $\forall\varepsilon>0$, $\exists n\in\NN$ large enough such that $\abs{W}\leq \varepsilon$ on $B(0,n)$. Thus, by the maximum principle, $\abs{W}\leq \varepsilon$ on $\overline{B(0,n)}\cap \Omega^c$. Since the $\varepsilon$ is arbitrary, we must have $W=0$ on $\Omega^c$, that is, $V_1=V_2$.
\end{proof}
\subsubsection{Expansion in spherical harmonics}\label{sec:laplace_spherical_potential}
We have just seen that $V$ satisfies the exterior Dirichlet problem for the Laplace equation. In \cref{sec:laplace_spherical} we have seen that a solution to the Laplace equation can be expressed as:
\begin{equation}\label{eq:prePotential}
  V(r,\theta,\phi) = \sum_{n=0}^\infty \sum_{m=0}^n (a_n r^{n} +b_{n}r^{-n-1})(\tilde{c}_{n,m}Y_{n,m}^{\mathrm{c}}(\theta,\phi)+\tilde{s}_{n,m}Y_{n,m}^{\mathrm{s}}(\theta,\phi))
\end{equation}
where $a_n,b_n,\tilde{c}_{n,m},\tilde{d}_{n,m}\in\RR$. If we impose $V$ to satisfy the third condition of \cref{eq:dirichletProblem}, we must have $a_{n}=0$.
Finally, if we choose $R_\oplus$ as a reference radius for a spherical model of the Earth, using the boundary condition on $\Fr{\Omega}$
\begin{equation}
  f(\theta,\phi) = \sum_{n=0}^\infty \sum_{m=-n}^n \frac{b_{n}}{{R_\oplus}^{n+1}}(\tilde{c}_{n,m}Y_{n,m}^{\mathrm{c}}(\theta,\phi)+\tilde{s}_{n,m}Y_{n,m}^{\mathrm{s}}(\theta,\phi))
\end{equation}
and the orthogonality of the spherical harmonics we can deduce that the coefficients $b_n\tilde{c}_{n,m}$ and $b_n\tilde{s}_{n,m}$ are given by:
\begin{align}
  b_n\tilde{c}_{n,m} & =\frac{{R_\oplus}^{n+1}}{4\pi}\int_0^{2\pi}\int_0^\pi f(\theta,\phi) Y_{n,m}^\mathrm{c}(\theta,\phi)\sin\phi\dd{\phi}\dd{\theta} \\
  b_n\tilde{s}_{n,m} & =\frac{{R_\oplus}^{n+1}}{4\pi}\int_0^{2\pi}\int_0^\pi f(\theta,\phi) Y_{n,m}^\mathrm{s}(\theta,\phi)\sin\phi\dd{\phi}\dd{\theta}
\end{align}

Hence introducing the gravitational constant $G$ and the Earth's mass $M_\oplus$ to the equation, our final expression for the gravitational potential is
\begin{equation}\label{eq:Potential}
  V(r,\theta,\phi) =\frac{GM_\oplus}{R_\oplus}\sum_{n=0}^\infty \sum_{m=0}^n{\left(\frac{{R_\oplus}}{r}\right)}^{n+1}(C_{n,m}Y_{n,m}^{\mathrm{c}}(\theta,\phi)+S_{n,m}Y_{n,m}^{\mathrm{s}}(\theta,\phi))
\end{equation}
where the coefficients $C_{n,m},S_{n,m}\in\RR$ are given by the formulas:
\begin{align}
  C_{n,m} & =\frac{1}{4\pi}\frac{R_\oplus}{G M_\oplus}\int_0^{2\pi}\int_0^\pi f(\theta,\phi)  Y_{n,m}^\mathrm{c}(\theta,\phi)\sin\phi\dd{\phi}\dd{\theta} \\
  S_{n,m} & =\frac{1}{4\pi}\frac{R_\oplus}{G M_\oplus}\int_0^{2\pi}\int_0^\pi f(\theta,\phi)  Y_{n,m}^\mathrm{s}(\theta,\phi)\sin\phi\dd{\phi}\dd{\theta}
\end{align}
% My coefficients Cnm and Snm are the \bar{Cnm} and \bar{Snm} in Montebruck's book
here $\delta_{0,m}$ denotes the Kronecker delta. The coefficients $C_{n,m}$, $S_{n,m}$ describe the dependence on the Earth's internal structure. They are obtained from observation of the perturbations seen in the orbits of other satellites \cite{montenbruck}. Other methods for obtaining such data are through surface gravimetry, which provides precise local and regional information about the gravity field, or through altimeter data, which can be used to provide a model for the geoid of the Earth, that is the shape that the ocean surface would take under the influence of the gravity of Earth, which in turn can be used to obtain the geopotential coefficients.
\subsubsection{Numerical computation of the gravity acceleration}
POSAR LES RECURRENCIES I MENCIONAR CUNNINGHAM
\end{document}